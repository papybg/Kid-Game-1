<html lang="bg" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ö—ä–¥–µ –¥–∞ –º–µ –æ—Ç–∫—Ä–∏–µ—à? - –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª–Ω–∞ –∏–≥—Ä–∞</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fredoka:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                borderRadius: {
                    lg: "var(--radius)",
                    md: "calc(var(--radius) - 2px)",
                    sm: "calc(var(--radius) - 4px)",
                },
                colors: {
                    background: "var(--background)",
                    foreground: "var(--foreground)",
                    card: {
                        DEFAULT: "var(--card)",
                        foreground: "var(--card-foreground)",
                    },
                    popover: {
                        DEFAULT: "var(--popover)",
                        foreground: "var(--popover-foreground)",
                    },
                    primary: {
                        DEFAULT: "var(--primary)",
                        foreground: "var(--primary-foreground)",
                    },
                    secondary: {
                        DEFAULT: "var(--secondary)",
                        foreground: "var(--secondary-foreground)",
                    },
                    muted: {
                        DEFAULT: "var(--muted)",
                        foreground: "var(--muted-foreground)",
                    },
                    accent: {
                        DEFAULT: "var(--accent)",
                        foreground: "var(--accent-foreground)",
                    },
                    destructive: {
                        DEFAULT: "var(--destructive)",
                        foreground: "var(--destructive-foreground)",
                    },
                    border: "var(--border)",
                    input: "var(--input)",
                    ring: "var(--ring)",
                },
                fontFamily: {
                    sans: ['Inter', 'system-ui', 'sans-serif'],
                    display: ['Fredoka', 'Inter', 'system-ui', 'sans-serif'],
                },
                animation: {
                    'fade-in': 'fadeIn 0.5s ease-out',
                    'slide-up': 'slideUp 0.3s ease-out',
                    'pulse-glow': 'pulseGlow 2s infinite',
                    'bounce-in': 'bounceIn 0.6s ease-out',
                    'shake': 'shake 0.5s ease-in-out',
                    'pop': 'pop 0.3s ease-out',
                },
                keyframes: {
                    fadeIn: {
                        '0%': { opacity: '0' },
                        '100%': { opacity: '1' }
                    },
                    slideUp: {
                        '0%': { opacity: '0', transform: 'translateY(20px)' },
                        '100%': { opacity: '1', transform: 'translateY(0)' }
                    },
                    pulseGlow: {
                        '0%, 100%': { boxShadow: '0 0 20px rgba(59, 130, 246, 0.3)' },
                        '50%': { boxShadow: '0 0 40px rgba(59, 130, 246, 0.6)' }
                    },
                    bounceIn: {
                        '0%': { opacity: '0', transform: 'scale(0.3)' },
                        '50%': { opacity: '1', transform: 'scale(1.05)' },
                        '70%': { transform: 'scale(0.9)' },
                        '100%': { opacity: '1', transform: 'scale(1)' }
                    },
                    shake: {
                        '0%, 100%': { transform: 'translateX(0)' },
                        '10%, 30%, 50%, 70%, 90%': { transform: 'translateX(-5px)' },
                        '20%, 40%, 60%, 80%': { transform: 'translateX(5px)' }
                    },
                    pop: {
                        '0%': { transform: 'scale(1)' },
                        '50%': { transform: 'scale(1.1)' },
                        '100%': { transform: 'scale(1)' }
                    }
                }
            }
        }
    };
    </script>
    
    <style>
        :root {
            --background: hsl(210 40% 98%);
            --foreground: hsl(222.2 84% 4.9%);
            --card: hsl(0 0% 100%);
            --card-foreground: hsl(222.2 84% 4.9%);
            --popover: hsl(0 0% 100%);
            --popover-foreground: hsl(222.2 84% 4.9%);
            --primary: hsl(221.2 83.2% 53.3%);
            --primary-foreground: hsl(210 40% 98%);
            --secondary: hsl(210 40% 96%);
            --secondary-foreground: hsl(222.2 84% 4.9%);
            --muted: hsl(210 40% 96%);
            --muted-foreground: hsl(215.4 16.3% 46.9%);
            --accent: hsl(210 40% 96%);
            --accent-foreground: hsl(222.2 84% 4.9%);
            --destructive: hsl(0 84.2% 60.2%);
            --destructive-foreground: hsl(210 40% 98%);
            --border: hsl(214.3 31.8% 91.4%);
            --input: hsl(214.3 31.8% 91.4%);
            --ring: hsl(221.2 83.2% 53.3%);
            --radius: 0.75rem;
        }
        
        .dark {
            --background: hsl(222.2 84% 4.9%);
            --foreground: hsl(210 40% 98%);
            --card: hsl(222.2 84% 4.9%);
            --card-foreground: hsl(210 40% 98%);
            --popover: hsl(222.2 84% 4.9%);
            --popover-foreground: hsl(210 40% 98%);
            --primary: hsl(217.2 91.2% 59.8%);
            --primary-foreground: hsl(222.2 84% 4.9%);
            --secondary: hsl(217.2 32.6% 17.5%);
            --secondary-foreground: hsl(210 40% 98%);
            --muted: hsl(217.2 32.6% 17.5%);
            --muted-foreground: hsl(215 20.2% 65.1%);
            --accent: hsl(217.2 32.6% 17.5%);
            --accent-foreground: hsl(210 40% 98%);
            --destructive: hsl(0 62.8% 30.6%);
            --destructive-foreground: hsl(210 40% 98%);
            --border: hsl(217.2 32.6% 17.5%);
            --input: hsl(217.2 32.6% 17.5%);
            --ring: hsl(224.3 76.3% 94.1%);
        }

        /* Glass morphism effects */
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Game specific styles */
        .game-slot {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .game-slot.active {
            animation: pulse-glow 2s infinite;
        }
        
        .choice-item {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .choice-item:hover:not(.used) {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .choice-item.used {
            opacity: 0.3;
            filter: grayscale(100%);
        }

        /* Loading animation */
        .loading-spinner {
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom scrollbar */
        .choice-zone::-webkit-scrollbar {
            height: 8px;
        }
        
        .choice-zone::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        
        .choice-zone::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }
        
        .choice-zone::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
    </style>
</head>

<body class="h-full bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-slate-900 dark:via-blue-900 dark:to-indigo-900 text-foreground transition-colors duration-300">

    <!-- @COMPONENT: WelcomeScreen -->
    <div id="welcomeScreen" class="screen fixed inset-0 z-50 flex flex-col items-center justify-center p-4 bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-700 animate-fade-in">
        <div class="text-center space-y-8 max-w-md mx-auto">
            <!-- App Icon -->
            <div class="mx-auto w-24 h-24 bg-white/20 rounded-3xl flex items-center justify-center backdrop-blur-sm animate-bounce-in">
                <i class="fas fa-puzzle-piece text-4xl text-white"></i>
            </div>
            
            <!-- Title -->
            <div class="space-y-2">
                <h1 class="font-display font-bold text-4xl md:text-5xl text-white text-center animate-slide-up">
                    –ö—ä–¥–µ –¥–∞ –º–µ –æ—Ç–∫—Ä–∏–µ—à?
                </h1>
                <p class="text-blue-100 text-lg text-center animate-slide-up" style="animation-delay: 0.1s">
                    –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª–Ω–∞ –∏–≥—Ä–∞ –∑–∞ –¥–µ—Ü–∞
                </p>
            </div>
            
            <!-- Features -->
            <div class="grid grid-cols-2 gap-4 text-sm text-blue-100 animate-slide-up" style="animation-delay: 0.2s">
                <div class="flex items-center gap-2">
                    <i class="fas fa-brain text-blue-200"></i>
                    <span>–†–∞–∑–≤–∏–≤–∞ –º–∏—Å–ª–µ–Ω–µ—Ç–æ</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-gamepad text-blue-200"></i>
                    <span>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∏–≥—Ä–∞</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-mobile-alt text-blue-200"></i>
                    <span>–ó–∞ –≤—Å–∏—á–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-volume-up text-blue-200"></i>
                    <span>–ó–≤—É–∫–æ–≤–∏ –µ—Ñ–µ–∫—Ç–∏</span>
                </div>
            </div>
            
            <!-- Enter Button -->
            <button id="enterGameBtn" class="w-full bg-white text-blue-600 font-semibold py-4 px-8 rounded-2xl text-lg hover:bg-blue-50 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl animate-slide-up" style="animation-delay: 0.3s" data-event="click:enterGame">
                <i class="fas fa-play mr-2"></i>
                –ó–ê–ü–û–ß–ù–ò –ò–ì–†–ê–¢–ê
            </button>
        </div>
        
        <!-- Settings Button -->
        <button id="settingsBtn" class="absolute top-4 right-4 w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm hover:bg-white/30 transition-colors" data-event="click:openSettings">
            <i class="fas fa-cog text-white text-xl"></i>
        </button>
    </div>
    <!-- @END_COMPONENT: WelcomeScreen -->

    <!-- @COMPONENT: StartScreen -->
    <div id="startScreen" class="screen fixed inset-0 z-40 flex flex-col p-4 bg-background hidden">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <button id="backToWelcomeBtn" class="w-12 h-12 bg-card rounded-xl flex items-center justify-center shadow-md hover:shadow-lg transition-shadow" data-event="click:backToWelcome">
                <i class="fas fa-arrow-left text-foreground"></i>
            </button>
            
            <h1 class="font-display font-bold text-2xl md:text-3xl text-center flex-1">
                –ò–∑–±–µ—Ä–∏ —Å–≤–µ—Ç–æ–≤–µ—Ç–µ
            </h1>
            
            <button id="themeToggle" class="w-12 h-12 bg-card rounded-xl flex items-center justify-center shadow-md hover:shadow-lg transition-shadow" data-event="click:toggleTheme">
                <i class="fas fa-moon dark:hidden text-foreground"></i>
                <i class="fas fa-sun hidden dark:block text-foreground"></i>
            </button>
        </div>
        
        <!-- Portal Container -->
        <div id="portalContainer" class="flex-1 overflow-y-auto">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
                <!-- Portal cards will be dynamically generated -->
                <!-- @MAP: portals.map(portal => ( -->
                <div class="portal-card bg-card rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2 cursor-pointer animate-slide-up" data-portal-id="dolina" data-event="click:selectPortal">
                    <div class="relative">
                        <!-- Beautiful landscape with rolling green hills and scattered wildflowers -->
                        <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=300" alt="–ó–µ–ª–µ–Ω–∞ –¥–æ–ª–∏–Ω–∞" class="w-full h-48 object-cover" data-mock="true">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                        <div class="absolute bottom-4 left-4 text-white">
                            <h3 class="font-display font-semibold text-xl">–ó–µ–ª–µ–Ω–∞ –¥–æ–ª–∏–Ω–∞</h3>
                            <p class="text-sm text-gray-200">–û—Ç–∫—Ä–∏–π –∂–∏–≤–æ—Ç–Ω–∏—Ç–µ –≤ –ø—Ä–∏—Ä–æ–¥–∞—Ç–∞</p>
                        </div>
                        <div class="absolute top-4 right-4 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-leaf text-white text-sm"></i>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2 text-sm text-muted-foreground">
                                <i class="fas fa-star text-yellow-400"></i>
                                <span>–õ–µ—Å–Ω–æ</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <i class="fas fa-puzzle-piece text-primary text-sm"></i>
                                <span class="text-sm text-muted-foreground" data-bind="portal.levels.length">5 –Ω–∏–≤–∞</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- @END_MAP )) -->
                
                <!-- Additional portal cards (mocked) -->
                <div class="portal-card bg-card rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2 cursor-pointer animate-slide-up opacity-50" style="animation-delay: 0.1s">
                    <div class="relative">
                        <!-- Underwater coral reef scene with colorful fish and marine life -->
                        <img src="https://images.unsplash.com/photo-1544551763-46a013bb70d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=300" alt="–ü–æ–¥–≤–æ–¥–µ–Ω —Å–≤—è—Ç" class="w-full h-48 object-cover" data-mock="true">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                        <div class="absolute bottom-4 left-4 text-white">
                            <h3 class="font-display font-semibold text-xl">–ü–æ–¥–≤–æ–¥–µ–Ω —Å–≤—è—Ç</h3>
                            <p class="text-sm text-gray-200">–°–∫–æ—Ä–æ...</p>
                        </div>
                        <div class="absolute top-4 right-4 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-fish text-white text-sm"></i>
                        </div>
                        <div class="absolute inset-0 bg-black/30 flex items-center justify-center">
                            <i class="fas fa-lock text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2 text-sm text-muted-foreground">
                                <i class="fas fa-star text-yellow-400"></i>
                                <span>–°—Ä–µ–¥–Ω–æ</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <i class="fas fa-puzzle-piece text-primary text-sm"></i>
                                <span class="text-sm text-muted-foreground">8 –Ω–∏–≤–∞</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="portal-card bg-card rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2 cursor-pointer animate-slide-up opacity-50" style="animation-delay: 0.2s">
                    <div class="relative">
                        <!-- Vast African savanna with acacia trees and wildlife silhouettes -->
                        <img src="https://images.unsplash.com/photo-1516426122078-c23e76319801?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&h=300" alt="–ê—Ñ—Ä–∏–∫–∞–Ω—Å–∫–∞ —Å–∞–≤–∞–Ω–∞" class="w-full h-48 object-cover" data-mock="true">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                        <div class="absolute bottom-4 left-4 text-white">
                            <h3 class="font-display font-semibold text-xl">–ê—Ñ—Ä–∏–∫–∞–Ω—Å–∫–∞ —Å–∞–≤–∞–Ω–∞</h3>
                            <p class="text-sm text-gray-200">–°–∫–æ—Ä–æ...</p>
                        </div>
                        <div class="absolute top-4 right-4 w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-paw text-white text-sm"></i>
                        </div>
                        <div class="absolute inset-0 bg-black/30 flex items-center justify-center">
                            <i class="fas fa-lock text-white text-2xl"></i>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2 text-sm text-muted-foreground">
                                <i class="fas fa-star text-red-400"></i>
                                <span>–¢—Ä—É–¥–Ω–æ</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <i class="fas fa-puzzle-piece text-primary text-sm"></i>
                                <span class="text-sm text-muted-foreground">12 –Ω–∏–≤–∞</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Progress Stats -->
        <div class="mt-8 bg-card rounded-2xl p-6 shadow-lg">
            <h3 class="font-semibold text-lg mb-4">–¢–≤–æ—è—Ç –ø—Ä–æ–≥—Ä–µ—Å</h3>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div>
                    <div class="text-2xl font-bold text-primary" data-bind="stats.totalLevels">3</div>
                    <div class="text-sm text-muted-foreground">–ó–∞–≤—ä—Ä—à–µ–Ω–∏ –Ω–∏–≤–∞</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-green-500" data-bind="stats.successRate">85%</div>
                    <div class="text-sm text-muted-foreground">–¢–æ—á–Ω–æ—Å—Ç</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-orange-500" data-bind="stats.playtime">12–º</div>
                    <div class="text-sm text-muted-foreground">–í—Ä–µ–º–µ –∑–∞ –∏–≥—Ä–∞</div>
                </div>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: StartScreen -->

    <!-- @COMPONENT: GameScreen -->
    <div id="gameScreen" class="screen fixed inset-0 z-30 hidden">
        <!-- Game Background -->
        <div id="gameBoard" class="absolute inset-0 bg-cover bg-center bg-no-repeat transition-all duration-500" style="background-image: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&h=1080');" data-mock-image="true" data-implementation="Dynamic background based on selected portal">
            <!-- Overlay for better contrast -->
            <div class="absolute inset-0 bg-black/20"></div>
        </div>
        
        <!-- Game Header -->
        <div class="relative z-20 p-4 bg-gradient-to-b from-black/50 to-transparent">
            <div class="flex items-center justify-between">
                <button id="backToMenuBtn" class="w-12 h-12 glass rounded-xl flex items-center justify-center hover:bg-white/20 transition-colors" data-event="click:backToMenu">
                    <i class="fas fa-arrow-left text-white"></i>
                </button>
                
                <div class="text-center text-white">
                    <h1 id="gameTitle" class="font-display font-bold text-xl md:text-2xl" data-bind="currentPortal.name">–ó–µ–ª–µ–Ω–∞ –¥–æ–ª–∏–Ω–∞</h1>
                    <div id="gameMessage" class="text-sm bg-white/20 backdrop-blur-sm rounded-full px-4 py-1 mt-2 inline-block" data-bind="gameState.message">–ù–∞—Ç–∏—Å–Ω–∏ –°–¢–ê–†–¢ –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—à!</div>
                </div>
                
                <div class="flex items-center gap-2">
                    <button id="pauseBtn" class="w-12 h-12 glass rounded-xl flex items-center justify-center hover:bg-white/20 transition-colors" data-event="click:pauseGame">
                        <i class="fas fa-pause text-white"></i>
                    </button>
                    <button id="soundToggle" class="w-12 h-12 glass rounded-xl flex items-center justify-center hover:bg-white/20 transition-colors" data-event="click:toggleSound">
                        <i class="fas fa-volume-up text-white"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Game Slots Overlay -->
        <div id="dropZone" class="absolute inset-0 z-10 pointer-events-none">
            <!-- Slots will be dynamically positioned -->
            <!-- @MAP: currentLevel.slots.map(slot => ( -->
            <div class="game-slot absolute w-16 h-16 border-4 border-dashed border-yellow-400 rounded-full bg-yellow-400/20 backdrop-blur-sm pointer-events-auto transition-all duration-300" 
                 style="top: 20%; left: 30%; transform: translate(-50%, -50%)" 
                 data-slot-index="0" 
                 data-expected-items="[1,2,3]">
            </div>
            <!-- @END_MAP )) -->
            
            <!-- Additional slots for demo -->
            <div class="game-slot absolute w-16 h-16 border-4 border-dashed border-yellow-400 rounded-full bg-yellow-400/20 backdrop-blur-sm pointer-events-auto transition-all duration-300" 
                 style="top: 60%; left: 70%; transform: translate(-50%, -50%)" 
                 data-slot-index="1">
            </div>
            <div class="game-slot absolute w-16 h-16 border-4 border-dashed border-yellow-400 rounded-full bg-yellow-400/20 backdrop-blur-sm pointer-events-auto transition-all duration-300" 
                 style="top: 40%; left: 15%; transform: translate(-50%, -50%)" 
                 data-slot-index="2">
            </div>
        </div>
        
        <!-- Feedback Messages -->
        <div id="feedbackMessage" class="absolute inset-0 z-50 flex items-center justify-center pointer-events-none">
            <div class="feedback-text font-display font-bold text-6xl md:text-8xl text-center opacity-0 transition-all duration-300" data-bind="feedback.message">–ë–†–ê–í–û!</div>
        </div>
        
        <!-- Game Footer -->
        <div class="absolute bottom-0 left-0 right-0 z-20 p-4 bg-gradient-to-t from-black/50 to-transparent">
            <!-- Start Turn Button -->
            <div id="startTurnContainer" class="text-center mb-4">
                <button id="startTurnBtn" class="bg-primary hover:bg-primary/90 text-primary-foreground font-semibold py-3 px-8 rounded-2xl text-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105" data-event="click:startTurn">
                    <i class="fas fa-play mr-2"></i>
                    –°–¢–ê–†–¢
                </button>
            </div>
            
            <!-- Choice Zone -->
            <div id="choiceZoneContainer" class="max-w-6xl mx-auto">
                <div class="bg-black/30 backdrop-blur-sm rounded-2xl p-4">
                    <div id="choiceZone" class="choice-zone flex gap-3 overflow-x-auto pb-2">
                        <!-- Choice items will be dynamically generated -->
                        <!-- @MAP: choiceItems.map(item => ( -->
                        <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100" alt="–ó–∞–µ–∫" class="choice-item w-16 h-16 bg-white rounded-xl object-cover cursor-pointer flex-shrink-0 border-2 border-white/50 hover:border-yellow-400" data-item-id="1" data-item-index="[1]" data-event="click:selectChoice" data-mock="true">
                        <!-- @END_MAP )) -->
                        
                        <!-- Additional choice items for demo -->
                        <img src="https://images.unsplash.com/photo-1583337130417-3346a1be7dee?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100" alt="–ü–µ–ø–µ—Ä—É–¥–∞" class="choice-item w-16 h-16 bg-white rounded-xl object-cover cursor-pointer flex-shrink-0 border-2 border-white/50 hover:border-yellow-400" data-item-id="2" data-mock="true">
                        <img src="https://images.unsplash.com/photo-1535930891776-0c2dfb7fda1a?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100" alt="–ü—á–µ–ª–∞" class="choice-item w-16 h-16 bg-white rounded-xl object-cover cursor-pointer flex-shrink-0 border-2 border-white/50 hover:border-yellow-400" data-item-id="3" data-mock="true">
                        <img src="https://pixabay.com/get/gce7198aea3583c70e254fa53905b0487c3b1aede9237e90358d8091cd0da1d3b49ab78ffb8c98d7ad82bc37fd2fc95f505c577bcc6dbe788dac1d0f5d1b7fafe_1280.jpg" alt="–ü—Ç–∏—á–∫–∞" class="choice-item w-16 h-16 bg-white rounded-xl object-cover cursor-pointer flex-shrink-0 border-2 border-white/50 hover:border-yellow-400" data-item-id="4" data-mock="true">
                        <img src="https://pixabay.com/get/gce7198aea3583c70e254fa53905b0487c3b1aede9237e90358d8091cd0da1d3b49ab78ffb8c98d7ad82bc37fd2fc95f505c577bcc6dbe788dac1d0f5d1b7fafe_1280.jpg" alt="–¶–≤–µ—Ç–µ" class="choice-item w-16 h-16 bg-white rounded-xl object-cover cursor-pointer flex-shrink-0 border-2 border-white/50 hover:border-yellow-400" data-item-id="5" data-mock="true">
                        <img src="https://pixabay.com/get/gce7198aea3583c70e254fa53905b0487c3b1aede9237e90358d8091cd0da1d3b49ab78ffb8c98d7ad82bc37fd2fc95f505c577bcc6dbe788dac1d0f5d1b7fafe_1280.jpg" alt="–ö–æ—Ç–∫–∞" class="choice-item w-16 h-16 bg-white rounded-xl object-cover cursor-pointer flex-shrink-0 border-2 border-white/50 hover:border-yellow-400" data-item-id="6" data-mock="true">
                        <img src="https://images.unsplash.com/photo-1552053831-71594a27632d?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100" alt="–ö—É—á–µ" class="choice-item w-16 h-16 bg-white rounded-xl object-cover cursor-pointer flex-shrink-0 border-2 border-white/50 hover:border-yellow-400" data-item-id="7" data-mock="true">
                        <img src="https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100" alt="–î—ä—Ä–≤–æ" class="choice-item w-16 h-16 bg-white rounded-xl object-cover cursor-pointer flex-shrink-0 border-2 border-white/50 hover:border-yellow-400" data-item-id="8" data-mock="true">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Progress Bar -->
        <div class="absolute top-20 left-4 right-4 z-20">
            <div class="max-w-sm mx-auto bg-black/30 backdrop-blur-sm rounded-full p-2">
                <div class="flex items-center justify-between text-white text-sm mb-1">
                    <span>–ü—Ä–æ–≥—Ä–µ—Å</span>
                    <span data-bind="gameState.progress">2/5</span>
                </div>
                <div class="w-full bg-white/20 rounded-full h-2">
                    <div class="bg-yellow-400 h-2 rounded-full transition-all duration-500 w-2/5" data-bind="gameState.progressPercent"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: GameScreen -->

    <!-- @COMPONENT: WinScreen -->
    <div id="winScreen" class="screen fixed inset-0 z-50 flex flex-col items-center justify-center p-4 bg-gradient-to-br from-green-500 via-emerald-500 to-teal-600 hidden">
        <div class="text-center space-y-8 max-w-md mx-auto animate-bounce-in">
            <!-- Celebration Icon -->
            <div class="mx-auto w-32 h-32 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm animate-pulse-glow">
                <i class="fas fa-trophy text-6xl text-yellow-300"></i>
            </div>
            
            <!-- Win Message -->
            <div class="space-y-4">
                <h1 id="winMessage" class="font-display font-bold text-5xl md:text-6xl text-white text-center animate-bounce-in" data-bind="winState.message">–ë–†–ê–í–û!</h1>
                <p class="text-green-100 text-lg text-center">–£—Å–ø–µ—à–Ω–æ –∑–∞–≤—ä—Ä—à–∏ –Ω–∏–≤–æ—Ç–æ!</p>
                
                <!-- Score Stats -->
                <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-6 space-y-4">
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <div class="text-3xl font-bold text-white" data-bind="winState.score">100</div>
                            <div class="text-sm text-green-100">–¢–æ—á–∫–∏</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-white" data-bind="winState.time">1:23</div>
                            <div class="text-sm text-green-100">–í—Ä–µ–º–µ</div>
                        </div>
                    </div>
                    
                    <!-- Stars Rating -->
                    <div class="flex justify-center gap-2">
                        <i class="fas fa-star text-yellow-300 text-2xl"></i>
                        <i class="fas fa-star text-yellow-300 text-2xl"></i>
                        <i class="fas fa-star text-yellow-300 text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="space-y-4 w-full">
                <button id="nextLevelBtn" class="w-full bg-white text-green-600 font-semibold py-4 px-8 rounded-2xl text-lg hover:bg-green-50 transform hover:scale-105 transition-all duration-200 shadow-lg hover:shadow-xl" data-event="click:nextLevel">
                    <i class="fas fa-arrow-right mr-2"></i>
                    –°–õ–ï–î–í–ê–©–û –ù–ò–í–û
                </button>
                
                <div class="grid grid-cols-2 gap-4">
                    <button id="playAgainBtn" class="bg-white/20 backdrop-blur-sm text-white font-semibold py-3 px-6 rounded-xl hover:bg-white/30 transition-colors" data-event="click:playAgain">
                        <i class="fas fa-redo mr-2"></i>
                        –û—Ç–Ω–æ–≤–æ
                    </button>
                    <button id="winScreenMenuBtn" class="bg-white/20 backdrop-blur-sm text-white font-semibold py-3 px-6 rounded-xl hover:bg-white/30 transition-colors" data-event="click:backToMenu">
                        <i class="fas fa-home mr-2"></i>
                        –ú–µ–Ω—é
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Confetti Animation -->
        <div class="absolute inset-0 pointer-events-none overflow-hidden">
            <!-- Animated confetti particles would be generated here -->
        </div>
    </div>
    <!-- @END_COMPONENT: WinScreen -->

    <!-- @COMPONENT: SettingsModal -->
    <div id="settingsModal" class="fixed inset-0 z-60 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm hidden">
        <div class="bg-card rounded-2xl shadow-2xl max-w-md w-full animate-slide-up">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="font-display font-bold text-xl">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    <button id="closeSettingsBtn" class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-muted transition-colors" data-event="click:closeSettings">
                        <i class="fas fa-times text-muted-foreground"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- Sound Settings -->
                    <div>
                        <h3 class="font-semibold mb-3">–ó–≤—É–∫</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm">–ì–ª–∞–≤–µ–Ω –∑–≤—É–∫</span>
                                <button class="w-12 h-6 bg-primary rounded-full relative transition-colors" data-state="enabled">
                                    <div class="w-5 h-5 bg-white rounded-full absolute top-0.5 right-0.5 transition-transform"></div>
                                </button>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">–ó–≤—É–∫–æ–≤–∏ –µ—Ñ–µ–∫—Ç–∏</span>
                                <button class="w-12 h-6 bg-primary rounded-full relative transition-colors" data-state="enabled">
                                    <div class="w-5 h-5 bg-white rounded-full absolute top-0.5 right-0.5 transition-transform"></div>
                                </button>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">–ú—É–∑–∏–∫–∞</span>
                                <button class="w-12 h-6 bg-muted rounded-full relative transition-colors" data-state="disabled">
                                    <div class="w-5 h-5 bg-white rounded-full absolute top-0.5 left-0.5 transition-transform"></div>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Display Settings -->
                    <div>
                        <h3 class="font-semibold mb-3">–ò–∑–≥–ª–µ–¥</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm">–¢—ä–º–Ω–∞ —Ç–µ–º–∞</span>
                                <button class="w-12 h-6 bg-muted rounded-full relative transition-colors" data-state="disabled">
                                    <div class="w-5 h-5 bg-white rounded-full absolute top-0.5 left-0.5 transition-transform"></div>
                                </button>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">–ê–Ω–∏–º–∞—Ü–∏–∏</span>
                                <button class="w-12 h-6 bg-primary rounded-full relative transition-colors" data-state="enabled">
                                    <div class="w-5 h-5 bg-white rounded-full absolute top-0.5 right-0.5 transition-transform"></div>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Game Settings -->
                    <div>
                        <h3 class="font-semibold mb-3">–ò–≥—Ä–∞</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="text-sm block mb-2">–¢—Ä—É–¥–Ω–æ—Å—Ç</label>
                                <select class="w-full bg-input border border-border rounded-lg px-3 py-2 text-sm">
                                    <option>–õ–µ—Å–Ω–∞</option>
                                    <option selected>–°—Ä–µ–¥–Ω–∞</option>
                                    <option>–¢—Ä—É–¥–Ω–∞</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm">–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–∞–∑–≤–∞–Ω–µ</span>
                                <button class="w-12 h-6 bg-primary rounded-full relative transition-colors" data-state="enabled">
                                    <div class="w-5 h-5 bg-white rounded-full absolute top-0.5 right-0.5 transition-transform"></div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-3 mt-8">
                    <button class="flex-1 bg-destructive text-destructive-foreground font-semibold py-3 rounded-xl hover:bg-destructive/90 transition-colors" data-event="click:resetProgress">
                        –ò–∑—á–∏—Å—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å–∞
                    </button>
                    <button class="flex-1 bg-primary text-primary-foreground font-semibold py-3 rounded-xl hover:bg-primary/90 transition-colors" data-event="click:saveSettings">
                        –ó–∞–ø–∞–∑–∏
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: SettingsModal -->

    <!-- @COMPONENT: LoadingSpinner -->
    <div id="loadingSpinner" class="fixed inset-0 z-70 flex items-center justify-center bg-background/80 backdrop-blur-sm hidden">
        <div class="text-center space-y-4">
            <div class="w-16 h-16 loading-spinner mx-auto"></div>
            <p class="text-muted-foreground">–ó–∞—Ä–µ–∂–¥–∞...</p>
        </div>
    </div>
    <!-- @END_COMPONENT: LoadingSpinner -->

    <!-- Version Display -->
    <div id="version-display" class="fixed top-4 left-4 z-50 text-xs text-muted-foreground font-mono opacity-50">
        V: 2.0.0
    </div>

    <!-- Audio CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    
    <!-- Game Script -->
    <script>
        // @STATE: gameState, currentPortal, currentLevel, isPlaying, soundEnabled, themeMode
        
        (function() {
            'use strict';
            
            // Game State Management
            const gameState = {
                currentScreen: 'welcome',
                currentPortal: null,
                currentLevel: null,
                isPlaying: false,
                isPaused: false,
                soundEnabled: true,
                themeMode: 'light',
                progress: {
                    completedLevels: 0,
                    totalScore: 0,
                    playtime: 0
                }
            };
            
            // Mock Data
            const mockPortals = [
                {
                    id: 'dolina',
                    name: '–ó–µ–ª–µ–Ω–∞ –¥–æ–ª–∏–Ω–∞',
                    icon: 'assets/icons/portal_dolina.png',
                    levels: ['d1', 'd2', 'd3', 'd4', 'd5'],
                    difficulty: 'easy'
                }
            ];
            
            const mockLevel = {
                id: 'd1',
                name: '–ó–µ–ª–µ–Ω–∞ –¥–æ–ª–∏–Ω–∞ - –ù–∏–≤–æ 1',
                background: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4',
                slots: [
                    { index: [1, 2], position: { top: '20%', left: '30%' }, diameter: '64px' },
                    { index: [3, 4], position: { top: '60%', left: '70%' }, diameter: '64px' },
                    { index: [5, 6], position: { top: '40%', left: '15%' }, diameter: '64px' }
                ]
            };
            
            // DOM Elements
            const elements = {
                welcomeScreen: document.getElementById('welcomeScreen'),
                startScreen: document.getElementById('startScreen'),
                gameScreen: document.getElementById('gameScreen'),
                winScreen: document.getElementById('winScreen'),
                settingsModal: document.getElementById('settingsModal'),
                loadingSpinner: document.getElementById('loadingSpinner'),
                
                // Buttons
                enterGameBtn: document.getElementById('enterGameBtn'),
                backToWelcomeBtn: document.getElementById('backToWelcomeBtn'),
                themeToggle: document.getElementById('themeToggle'),
                settingsBtn: document.getElementById('settingsBtn'),
                closeSettingsBtn: document.getElementById('closeSettingsBtn'),
                backToMenuBtn: document.getElementById('backToMenuBtn'),
                startTurnBtn: document.getElementById('startTurnBtn'),
                playAgainBtn: document.getElementById('playAgainBtn'),
                winScreenMenuBtn: document.getElementById('winScreenMenuBtn'),
                nextLevelBtn: document.getElementById('nextLevelBtn'),
                pauseBtn: document.getElementById('pauseBtn'),
                soundToggle: document.getElementById('soundToggle'),
                
                // Game elements
                gameBoard: document.getElementById('gameBoard'),
                gameTitle: document.getElementById('gameTitle'),
                gameMessage: document.getElementById('gameMessage'),
                choiceZone: document.getElementById('choiceZone'),
                dropZone: document.getElementById('dropZone'),
                feedbackMessage: document.getElementById('feedbackMessage'),
                winMessage: document.getElementById('winMessage')
            };
            
            // Initialize Audio
            let audioContext = null;
            
            function initializeAudio() {
                if (typeof Tone !== 'undefined' && !audioContext) {
                    Tone.start();
                    audioContext = Tone.context;
                    console.log('Audio initialized');
                }
            }
            
            // Screen Management
            function showScreen(screenName) {
                // Hide all screens
                Object.values(elements).forEach(el => {
                    if (el && el.classList.contains('screen')) {
                        el.classList.add('hidden');
                        el.classList.remove('visible');
                    }
                });
                
                // Show requested screen
                const screen = elements[screenName + 'Screen'];
                if (screen) {
                    screen.classList.remove('hidden');
                    screen.classList.add('visible');
                    gameState.currentScreen = screenName;
                }
                
                // Handle loading state
                if (screenName === 'game') {
                    elements.loadingSpinner.classList.remove('hidden');
                    setTimeout(() => {
                        elements.loadingSpinner.classList.add('hidden');
                    }, 1000);
                }
            }
            
            // Theme Management
            function toggleTheme() {
                const html = document.documentElement;
                if (html.classList.contains('dark')) {
                    html.classList.remove('dark');
                    gameState.themeMode = 'light';
                } else {
                    html.classList.add('dark');
                    gameState.themeMode = 'dark';
                }
                
                // Save to localStorage
                localStorage.setItem('theme', gameState.themeMode);
            }
            
            function loadTheme() {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                    gameState.themeMode = 'dark';
                }
            }
            
            // Game Logic
            function startGame(portal) {
                gameState.currentPortal = portal;
                gameState.currentLevel = mockLevel;
                showScreen('game');
                
                // Update game UI
                elements.gameTitle.textContent = portal.name;
                elements.gameMessage.textContent = '–ù–∞—Ç–∏—Å–Ω–∏ –°–¢–ê–†–¢ –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—à!';
                
                // TODO: Load actual level data
                // TODO: Initialize game board with slots
                // TODO: Generate choice items
            }
            
            function startTurn() {
                gameState.isPlaying = true;
                elements.startTurnBtn.style.display = 'none';
                elements.gameMessage.textContent = '–ö–∞–∫–≤–æ —â–µ –∏–º–∞ —Ç—É–∫?';
                
                // Activate first slot
                const firstSlot = document.querySelector('.game-slot');
                if (firstSlot) {
                    firstSlot.classList.add('active');
                }
                
                // TODO: Implement turn logic
                console.log('Turn started');
            }
            
            function handleChoiceClick(event) {
                const choiceItem = event.target;
                if (choiceItem.classList.contains('used')) return;
                
                // Mock validation
                const isCorrect = Math.random() > 0.3; // 70% success rate for demo
                
                if (isCorrect) {
                    showFeedback(true, '–ë—Ä–∞–≤–æ!');
                    choiceItem.classList.add('used');
                    
                    // TODO: Place item in slot
                    // TODO: Check if level complete
                    
                    setTimeout(() => {
                        if (Math.random() > 0.6) { // 40% chance to win for demo
                            showWinScreen();
                        } else {
                            activateNextSlot();
                        }
                    }, 1500);
                } else {
                    showFeedback(false, '–û–ø–∏—Ç–∞–π –ø–∞–∫!');
                    choiceItem.style.animation = 'shake 0.5s ease-in-out';
                    setTimeout(() => {
                        choiceItem.style.animation = '';
                    }, 500);
                }
            }
            
            function showFeedback(isCorrect, message) {
                const feedback = elements.feedbackMessage.querySelector('.feedback-text');
                feedback.textContent = message;
                feedback.className = `feedback-text font-display font-bold text-6xl md:text-8xl text-center transition-all duration-300 ${isCorrect ? 'text-green-400' : 'text-red-400'}`;
                feedback.style.opacity = '1';
                feedback.style.transform = 'scale(1.1)';
                
                setTimeout(() => {
                    feedback.style.opacity = '0';
                    feedback.style.transform = 'scale(1)';
                }, 1200);
            }
            
            function activateNextSlot() {
                // Deactivate current slot
                document.querySelectorAll('.game-slot.active').forEach(slot => {
                    slot.classList.remove('active');
                });
                
                // Activate random slot (demo)
                const slots = document.querySelectorAll('.game-slot:not(.completed)');
                if (slots.length > 0) {
                    const randomSlot = slots[Math.floor(Math.random() * slots.length)];
                    randomSlot.classList.add('active');
                    elements.gameMessage.textContent = '–ö–∞–∫–≤–æ —â–µ –∏–º–∞ —Ç—É–∫?';
                }
            }
            
            function showWinScreen() {
                showScreen('win');
                elements.winMessage.textContent = '–ë–†–ê–í–û!';
                
                // TODO: Calculate score and time
                // TODO: Save progress
                // TODO: Unlock next level
            }
            
            function pauseGame() {
                gameState.isPaused = !gameState.isPaused;
                const icon = elements.pauseBtn.querySelector('i');
                
                if (gameState.isPaused) {
                    icon.className = 'fas fa-play text-white';
                    // TODO: Pause game logic
                } else {
                    icon.className = 'fas fa-pause text-white';
                    // TODO: Resume game logic
                }
            }
            
            function toggleSound() {
                gameState.soundEnabled = !gameState.soundEnabled;
                const icon = elements.soundToggle.querySelector('i');
                
                if (gameState.soundEnabled) {
                    icon.className = 'fas fa-volume-up text-white';
                } else {
                    icon.className = 'fas fa-volume-mute text-white';
                }
                
                // Save to localStorage
                localStorage.setItem('soundEnabled', gameState.soundEnabled);
            }
            
            // Event Listeners
            function setupEventListeners() {
                // Navigation
                elements.enterGameBtn?.addEventListener('click', () => {
                    initializeAudio();
                    showScreen('start');
                });
                
                elements.backToWelcomeBtn?.addEventListener('click', () => {
                    showScreen('welcome');
                });
                
                elements.backToMenuBtn?.addEventListener('click', () => {
                    showScreen('start');
                });
                
                elements.winScreenMenuBtn?.addEventListener('click', () => {
                    showScreen('start');
                });
                
                // Settings
                elements.themeToggle?.addEventListener('click', toggleTheme);
                elements.settingsBtn?.addEventListener('click', () => {
                    elements.settingsModal.classList.remove('hidden');
                });
                
                elements.closeSettingsBtn?.addEventListener('click', () => {
                    elements.settingsModal.classList.add('hidden');
                });
                
                // Game controls
                elements.startTurnBtn?.addEventListener('click', startTurn);
                elements.playAgainBtn?.addEventListener('click', () => {
                    // TODO: Restart current level
                    showScreen('game');
                });
                
                elements.nextLevelBtn?.addEventListener('click', () => {
                    // TODO: Load next level
                    showScreen('game');
                });
                
                elements.pauseBtn?.addEventListener('click', pauseGame);
                elements.soundToggle?.addEventListener('click', toggleSound);
                
                // Portal selection
                document.querySelectorAll('.portal-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const portalId = card.dataset.portalId;
                        const portal = mockPortals.find(p => p.id === portalId);
                        if (portal) {
                            startGame(portal);
                        }
                    });
                });
                
                // Choice items
                document.querySelectorAll('.choice-item').forEach(item => {
                    item.addEventListener('click', handleChoiceClick);
                });
                
                // Close modals on outside click
                elements.settingsModal?.addEventListener('click', (e) => {
                    if (e.target === elements.settingsModal) {
                        elements.settingsModal.classList.add('hidden');
                    }
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.key) {
                        case 'Escape':
                            if (!elements.settingsModal.classList.contains('hidden')) {
                                elements.settingsModal.classList.add('hidden');
                            } else if (gameState.currentScreen === 'game') {
                                pauseGame();
                            }
                            break;
                        case ' ':
                            if (gameState.currentScreen === 'game' && !gameState.isPlaying) {
                                e.preventDefault();
                                startTurn();
                            }
                            break;
                    }
                });
            }
            
            // Initialize App
            function initializeApp() {
                console.log('Initializing app...');
                
                // Load saved preferences
                loadTheme();
                
                const savedSound = localStorage.getItem('soundEnabled');
                if (savedSound !== null) {
                    gameState.soundEnabled = savedSound === 'true';
                }
                
                // Setup event listeners
                setupEventListeners();
                
                // Show initial screen
                showScreen('welcome');
                
                console.log('App initialized successfully');
            }
            
            // Start the app when DOM is loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeApp);
            } else {
                initializeApp();
            }
            
        })();
    </script>
</body>
</html>